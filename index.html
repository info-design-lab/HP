<html>
	<head>
		<title>Harry Potter Dialogues</title>

		<!--Scripts-->
	   	<script src="scripts/d3.v4.js"></script>
	    <script src="scripts/queue.js"></script>
	    <script src="https://unpkg.com/d3-sankey@0"></script>
	    <script src="js/viz.js"></script>
        <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
	    <link href="css/main.css" rel="stylesheet">
	</head>
	<body>
		<h1 align=center style="margin-bottom: 70px">Harry Potter Series: Who said What?</h1>
		<table border=0 align="center" width=85% style="margin-bottom: 70px">
		<tr>
		<th align=right width=300 style="padding: 30px">
			<p> Accept 
			<svg width="15" height="15">
  				<rect width="15" height="15" style="fill:#957DAD;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg></p> 
			<p> Emphasis 
			<svg width="15" height="15">
  				<rect width="15" height="15" style="fill:#b7c68b;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg></p>
			<p> Greet 
			<svg width="15" height="15">
  				<rect width="15" height="15" style="fill:#875C36;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg></p>
			<p> 'N'Answer 
			<svg width="15" height="15">
  				<rect width="15" height="15" style="fill:#DF9881;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg></p>
			<p> Other 
			<svg width="15" height="15">
  				<rect width="15" height="15" style="fill:#58a6a6;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg></p>
			<p> Reject 
			<svg width="15" height="15">
  				<rect width="15" height="15" style="fill:#FE7914;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg></p>
			<p> Statement 
			<svg width="15" height="15">
  				<rect width="15" height="15" style="fill:#3d0158;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg></p>
			<p> System 
			<svg width="15" height="15">
  				<rect width="15" height="15" style="fill:#c33c23;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg></p>
			<p> 'Wh'Question 
			<svg width="15" height="15">
  				<rect width="15" height="15" style="fill:#a29574;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg></p>
			<p> 'Y'Answer 
			<svg width="15" height="15">
  				<rect width="15" height="15" style="fill:#59955c;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg></p>
			<p> 'Y/N'Question	
			<svg width="15" height="15">
  				<rect width="15" height="15" style="fill:#f69cc4;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg></p>		
		</th>
		<th>
		<div class="cover" align="center">
			<div id="chord_diagram"></div>
		</div>
		</th>		
		<th align="left" style="right-margin:30px" width=400>
			<p><svg width="15" height="15">
  				<rect width="15" height="15" style="fill:#7799cc;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg>
			Harry Potter</p>
			<p><svg width="15" height="15">
  			<rect width="15" height="15" style="fill:#FF6961;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg>
			Ron Weasley</p>			
			<p>
			<svg width="15" height="15">
  			<rect width="15" height="15" style="fill:#efa355;stroke-width:0;stroke:rgb(0,0,0)" />
			</svg>
			Hermione Granger</p>
		</th>
		</tr>
		</table>

		<div align="center" style="margin-bottom: 100px" >
		<div class="slidecontainer" align="center" border=1>
  			<div><table border=0 style="width: 100% font-size:50%"><tr>
			<input type="range" min="0" max="8" value="0" class="slider" id="myRange"></tr>
			<tr>
  			<th><span class="dot"></span></th>
			<th><span class="dot"></span></th>
			<th><span class="dot"></span></th>
			<th><span class="dot"></span></th>
			<th><span class="dot"></span></th>
			<th><span class="dot"></span></th>
			<th><span class="dot"></span></th>
			<th><span class="dot"></span></th>
			<th><span class="dot"></span></th>
			</tr>
			<tr>
  			<td>All Movies</td>
  			<td>Philosopher's Stone</td>
  			<td>Chamber of Secrets</td>
  			<td>Prisoner of Azkaban</td>
  			<td>Goblet of Fire</td>
  			<td>Order of the Phoenix</td>
  			<td>Half-Blood Prince</td>
  			<td>Deathly Hallows 1</td>
  			<td>Deathly Hallows 2</td> 
  			</tr></table></div>
  		</div>
  		</div> 

  		<h1 align=center style="margin-bottom: 40px">...and How much?</h1>

  		<div align="left">
  			<table align="center" border=1>
			<div id="sankey_diagram"></div></table>
		</div>

		<div id="controls" style="text-align:center;font-family:ubuntu;font-size:100%;color:#444444;margin-top: 10px;margin-bottom: 10px;">
		  <span>
		    <label style="margin-right: 10px;"><input id="harry" type="radio" name="grouping" value="harry" checked>Harry Potter</label>
		    <label style="margin-right: 10px;"><input id="ron" type="radio" name="grouping" value="ron" >Ron Weasley</label>
		    <label style="margin-right: 10px;"><input id="hermoine" type="radio" name="grouping" value="hermoine" >Hermione Granger</label>
		  </span>
		</div>

		<script src="js/chord.js">  </script>

		<script>
	
var full_data = [];
var bp;
var g;
var slider_value = 1;
var playing = 0;

d3.csv("sankey.csv", function(data) {
    data.forEach(function(d) {
        full_data.push([d['source'], d['target'], d['value']])
    });
    draw(full_data);
});

function draw(data) {
    var color = {
        "Accept": "#fdae61",
        "Greet": "#f89f5f",
        "nAnswer": "#f48f5d",
        "Other": "#ef805b",
        "Reject": "#ea7159",
        "Statement": "#e86958",
        "System": "#e66157",
        "whQuestion": "#e15255",
        'yAnswer': "#dd5e5c",
        'ynQuestion': "#d47569",
        "Emphasis": "#ca8c76",
        "m1": "#c1a383",
        "m2": "#b8ba90",
        "m3": "#b0d19d",
        "m4": "#abdda4",
        "m5": "#a0d5a6",
        "m6": "#8bc7aa",
        "m7": "#76b7ad",
        "m8": '#60a8b1',
        'all': "#4b9ab4"
    };
    var width = 1400;
    var height = 650;
    var sankey_dimension = {
        width: 700,
        height: 575
    }
    var svg = d3.select("#sankey_diagram").append("svg").attr("width", width).attr("height", height);

    svg.append("foreignObject")
        .attr("width", 200)
        .attr("height", 30)
        .attr('x', width / 2 - 100)
        .attr('y', 10)
        .append("xhtml:body")
        .style("font", "14px 'Roboto Condensed', 'Helvetica', 'Arial', sans-serif")
        //.html('<h4>Total Deaths - <span id="year-number">2001</span></h4>')

    bp = viz.bP()
        .data(data)
        .min(12)
        .pad(1)
        .height(sankey_dimension.height)
        .width(sankey_dimension.width)
        .barSize(35)
        .fill(d => color[d.primary]);

    g = svg.append("g").attr("transform", "translate(400,50)").call(bp);

    g.append("text").attr("x", -100).attr("y", -8).style("text-anchor", "middle").text("Movie Part").style("font-weight", 'normal').style('fill', '#808080').style("font", "'Roboto Condensed', 'Helvetica', 'Arial', sans-serif");

    g.append("text").attr("x", sankey_dimension.width + 100).attr("y", -8).style("text-anchor", "middle").text("Dialogue Type").style("font-weight", 'normal').style('fill', '#808080').style("font", "'Roboto Condensed', 'Helvetica', 'Arial', sans-serif");

    g.append("line").attr("x1", -100).attr("x2", 0);

    g.append("line").attr("x1", sankey_dimension.width).attr("x2", sankey_dimension.width + 100);

    g.append("text").attr("x", -5).attr("y", -8).style("text-anchor", "middle").text("%").style("font-weight", 'normal').style('fill', '#808080').style("font", "'Roboto Condensed', 'Helvetica', 'Arial', sans-serif");

    g.append("line").attr("y1", 620).attr("y2", 620).attr("x1", -100).attr("x2", 0);

    g.append("line").attr("y1", 620).attr("y2", 620).attr("x1", sankey_dimension.width).attr("x2", sankey_dimension.width + 100);

    g.append("text").attr("x", sankey_dimension.width + 5).attr("y", -8).style("text-anchor", "middle").text("%").style("font-weight", 'normal').style('fill', '#808080').style("font", "'Roboto Condensed', 'Helvetica', 'Arial', sans-serif");

    g.selectAll(".mainBars")
        .on("mouseover", mouseover);

    g.selectAll(".mainBars").append("text").attr("class", "label")
        .attr("x", d => (d.part == "primary" ? -90 : 90))
        .attr("y", d => +6)
				.style('fill', function(d){
					return '#6a6a6a'
				}) // '#6a6a6a')
        .text(function(d) {
        	console.log(d);
        	if(d.key=="nAnswer") return "'N'Answer";
        	else if(d.key=="whQuestion") return "'Wh'Question";
        	else if(d.key=="yAnswer") return "'Y'Answer";
        	else if(d.key=="ynQuestion") return "'Y/N'Question";
        	else if(d.key=="m1") return "Philosopher's Stone";
        	else if(d.key=="m2") return "Chamber of Secrets";
        	else if(d.key=="m3") return "Prisoner of Azkaban";
        	else if(d.key=="m4") return "Goblet of Fire";
        	else if(d.key=="m5") return "Order of the Phoenix";
        	else if(d.key=="m6") return "Half-Blood Prince";
        	else if(d.key=="m7") return "Deathly Hallows 1";
        	else if(d.key=="m8") return "Deathly Hallows 2";
        	else if(d.key=="all") return "All Movies";
            else return d.key;})
				.style("font", "14px 'Roboto Condensed', 'Helvetica', 'Arial', sans-serif")
				.style('font-size', '12')
				.style('font-weight', 'normal')
        .attr("text-anchor", d => (d.part == "primary" ? "end" : "start"));

    g.selectAll(".mainBars").append("text").attr("class", "perc")
        .attr("x", d => (d.part == "primary" ? -22 : 22))
        .attr("y", d => +6)
        .text(function(d) {
            return parseInt((d.percent) * 100);
        })
        .style('fill', function(d){
					return '#6a6a6a'
				}) // '#6a6a6a')
        .style("font-weight", 'normal')
        .style("font", "'Roboto Condensed', 'Helvetica', 'Arial', sans-serif")
        .attr("text-anchor", d => (d.part == "primary" ? "end" : "start"));
  /**  g.selectAll(".mainBars").append("text").attr("class", "val")
        .attr("x", d => (d.part == "primary" ? -45 : 45))
        .attr("y", d => +6)
        .style("font-weight", 'normal')
        .text(function(d) {
            return d3.format("100")(d.value)
        })
        .style("font", "'Roboto Condensed', 'Helvetica', 'Arial', sans-serif")
				.style('fill', function(d){
					return d.part == "primary" ? color[d.key] : '#6a6a6a'
				}) // '#6a6a6a')
        .attr("text-anchor", d => (d.part == "primary" ? "end" : "start")); **/
    function mouseover(d) {
        g.selectAll(".mainBars").select(".perc")
            .text(function(d) {
                return parseInt((d.percent) * 100);
            });
        g.selectAll(".mainBars").select(".val")
            .text(function(d) {
                return d3.format("100")(d.value)
            });
    }
}


</script>


	</body>
</html>
